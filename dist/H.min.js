!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.H=e()}(this,function(){"use strict";var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};function e(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}function i(t,e,i,n){return new(i||(i=Promise))(function(s,r){function o(t){try{a(n.next(t))}catch(t){r(t)}}function h(t){try{a(n.throw(t))}catch(t){r(t)}}function a(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(o,h)}a((n=n.apply(t,e||[])).next())})}function n(t,e){var i,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function h(r){return function(h){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,h])}}}function s(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,s,r=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(s)throw s.error}}return o}function r(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}function o(t,e){void 0===t&&(t=300),void 0===e&&(e=150);var i=document.createElement("canvas");return i.setAttribute("width",String(t)),i.setAttribute("height",String(e)),i.style.cssText="position: absolute; top: 0; left: 0;",i}var h=function(){function t(t){this.forceRender=!1,this.objects=[];var e=t.el,i=+t.width||300,n=+t.height||150;this.container="string"==typeof e?document.querySelector(e):e,this.container.style.width=i+"px",this.container.style.height=n+"px",this.container.style.position="relative",this.width=i,this.height=n;var s=o(i,n);this.canvas=s,this.ctx=s.getContext("2d"),this.container.appendChild(s);var r=o(i,n);this.cacheCanvas=r,this.cacheCtx=r.getContext("2d"),requestAnimationFrame(this.loopAnim.bind(this))}return t.prototype.loopAnim=function(){this.renderObjects(),requestAnimationFrame(this.loopAnim.bind(this))},t.prototype.renderObjects=function(){var t=this;!this.forceRender&&this.objects.every(function(t){return!t.visible||!t.needUpdate()})||(this.cacheCtx.clearRect(0,0,this.width,this.height),this.objects.forEach(function(e){return e.render(t.cacheCtx)}),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.cacheCanvas,0,0),this.forceRender=!1)},t.prototype.add=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(t=this.objects).push.apply(t,r(e)),this},t.prototype.remove=function(t){for(var e=0;e<this.objects.length;e++)if(this.objects[e].id===t){this.objects.splice(e,1),this.forceRender=!0;break}return this},t}(),a=1,c={gen:function(){return a++}},u=Math.abs,l=function(){function t(t){var e=this;return this.type="displayObject",this.updateFlag=!1,this.visible=!0,this.left=0,this.top=0,this.width=0,this.height=0,this.originX="left",this.originY="top",this.scaleX=1,this.scaleY=1,this.id=c.gen(),this.proxy=new Proxy(this,{get:function(t,e,i){return Reflect.get(t,e,i)},set:function(t,i,n,s){return t[i]!==n&&(Reflect.set(t,i,n,s),-1!==s.constructor.updateList.indexOf(i)&&e.update(i)),!0}}),this.set(t),this.proxy}return t.prototype.update=function(t){this.updateFlag=!0},t.prototype.set=function(t){if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},t.prototype.needUpdate=function(){return this.updateFlag},t.prototype.render=function(t){this.visible&&this._render(t)},t.prototype.getWidth=function(){return u(this.width*this.scaleX)},t.prototype.getHeight=function(){return u(this.height*this.scaleY)},t.prototype.getOriginPoint=function(){var t="center"===this.originX?this.width/2:"right"===this.originX?this.width:0,e="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0;return{x:t=u(t*this.scaleX),y:e=u(e*this.scaleY)}},t.updateList=["visible","left","top","originX","originY"],t}();function p(t){return new Promise(function(e,i){var n=new Image;n.onload=e.bind(null,n),n.onerror=i.bind(null),n.src=t})}var f=function(t){function s(e){var i=t.call(this,null)||this;return i.type="bitmap",i.set(e),i}return e(s,t),s.prototype.update=function(t){return i(this,void 0,void 0,function(){var e,i;return n(this,function(n){switch(n.label){case 0:if("src"!==t)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),e=this,[4,p(this.src)];case 2:return e.bitmapSource=n.sent(),this.width=this.bitmapSource.width,this.height=this.bitmapSource.height,this.updateFlag=!0,[3,4];case 3:return i=n.sent(),console.error(i),[3,4];case 4:return[2];case 5:return this.updateFlag=!0,[2]}})})},s.prototype._render=function(t){if(this.bitmapSource){var e=this.getOriginPoint(),i=e.x,n=e.y,s=this.scaleX<0?-this.width:0,r=this.scaleY<0?-this.height:0;t.save(),t.translate(this.left-i,this.top-n),t.scale(this.scaleX,this.scaleY),t.drawImage(this.bitmapSource,s,r),t.restore(),this.updateFlag=!1}else this.updateFlag=!1},s.updateList=r(l.updateList,["src"]),s}(l),d=function(){var t,e;return{measureText:function(i,n){return t||(t=document.createElement("div"),e=document.createElement("span"),t.style.cssText="position: absolute; left: -9999px; top: -9999px;",t.appendChild(e),document.body.appendChild(t)),e.innerText=i,e.style.cssText=n,{width:e.offsetWidth,height:e.offsetHeight}}}}(),y='"PingFang SC", Verdana, "Helvetica Neue", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans-serif',g=function(t){function i(e){var i=t.call(this,null)||this;return i.type="text",i.fontSize=14,i.fontWeight="normal",i.fontFamily=y,i.color="#000000",i.set(e),i}return e(i,t),i.prototype.update=function(t){-1!==["text","fontSize","fontWeight","fontFamily"].indexOf(t)&&this.calcDimensions(),this.updateFlag=!0},i.prototype.calcDimensions=function(){if(this.text&&this.fontSize){var t="\n      font-family: "+this.fontFamily+";\n      font-size: "+this.fontSize+"px;\n      font-weight: "+this.fontWeight+";\n    ",e=d.measureText(this.text,t);this.width=e.width,this.height=e.height}else this.width=this.height=0},i.prototype._render=function(t){var e=this.getOriginPoint(),i=e.x,n=e.y,s=this.scaleX<0?-this.width:0,r=this.scaleY<0?-this.height:0;t.save(),t.translate(this.left-i,this.top-n),t.scale(this.scaleX,this.scaleY),t.textAlign="left",t.textBaseline="top",t.fillStyle=this.color,t.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,t.fillText(this.text,s,r),t.restore(),this.updateFlag=!1},i.updateList=r(l.updateList,["text","fontSize","fontWeight","fontFamily","color"]),i}(l),m=Math.min,v=Math.max,b=function(t){function i(e){var i=t.call(this,null)||this;return i.type="polygon",i.points=[],i.lineWidth=1,i.strokeColor="#000000",i.fillColor="transparent",i.set(e),i}return e(i,t),i.prototype.update=function(t){"points"===t&&this.calcDimensions(),this.updateFlag=!0},i.prototype.calcDimensions=function(){if(this.points&&!(this.points.length<3)){var t=m.apply(void 0,r(this.points.map(function(t){return t.x}))),e=v.apply(void 0,r(this.points.map(function(t){return t.x}))),i=m.apply(void 0,r(this.points.map(function(t){return t.y}))),n=v.apply(void 0,r(this.points.map(function(t){return t.y})));this.width=e-t,this.height=n-i}},i.prototype._render=function(t){if(!this.points||this.points.length<3)this.updateFlag=!1;else{var e=this.getOriginPoint(),i=e.x,n=e.y,s=this.scaleX<0?-this.width:0,r=this.scaleY<0?-this.height:0;t.save(),t.translate(this.left-i,this.top-n),t.scale(this.scaleX,this.scaleY),t.lineWidth=this.lineWidth,t.fillStyle=this.fillColor,t.strokeStyle=this.strokeColor,t.beginPath(),this.points.forEach(function(e,i){t[i?"lineTo":"moveTo"](e.x+s,e.y+r)}),t.closePath(),t.stroke(),t.fill(),t.restore(),this.updateFlag=!1}},i.updateList=r(l.updateList,["points","lineWidth","strokeColor","fillColor"]),i}(l),x=function(t){function s(e){var i=t.call(this,null)||this;return i.type="sprite",i.lastFrameTime=0,i.frameIndex=0,i.iteratedCount=0,i.set(e),i}return e(s,t),s.prototype.update=function(t){return i(this,void 0,void 0,function(){var e,i,s;return n(this,function(n){switch(n.label){case 0:if("src"!==t)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),e=this,[4,p(this.src)];case 2:return e.bitmapSource=n.sent(),s=this.frames[this.status],this.width=s.frameWidth,this.height=s.frameHeight,this.reset(),this.updateFlag=!0,[3,4];case 3:return i=n.sent(),console.error(i),[3,4];case 4:return[2];case 5:return"status"===t&&((s=this.frames[this.status]).src&&s.src!==this.src?this.src=s.src:(this.width=s.frameWidth,this.height=s.frameHeight,this.reset())),this.updateFlag=!0,[2]}})})},s.prototype.reset=function(){this.lastFrameTime=0,this.frameIndex=0,this.iteratedCount=0},s.prototype.isAnimationEnd=function(){var t=this.frames[this.status];return t.iterationCount&&this.iteratedCount>t.iterationCount},s.prototype._render=function(t){if(this.bitmapSource){var e=Date.now(),i=this.frames[this.status],n=i[this.frameIndex],s=this.getOriginPoint(),r=s.x,o=s.y,h=this.scaleX<0?-this.width:0,a=this.scaleY<0?-this.height:0;t.save(),t.translate(this.left-r,this.top-o),t.scale(this.scaleX,this.scaleY),t.drawImage(this.bitmapSource,n.x,n.y,this.width,this.height,h,a,this.width,this.height),t.restore(),this.lastFrameTime?e-this.lastFrameTime>=i.frameDuration&&(this.frameIndex++,this.lastFrameTime=e,this.frameIndex>=i.length&&(this.frameIndex=0,this.iteratedCount++)):this.lastFrameTime=e,this.updateFlag=!this.isAnimationEnd()}else this.updateFlag=!1},s.prototype.replay=function(){this.reset(),this.updateFlag=!0},s.updateList=r(l.updateList,["src","frames","status"]),s}(l);return{Stage:h,DisplayObject:l,Bitmap:f,Text:g,Polygon:b,Sprite:x}});
//# sourceMappingURL=H.min.js.map

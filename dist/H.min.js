!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.H=e()}(this,function(){"use strict";var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};function e(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}function i(t,e,i,n){return new(i||(i=Promise))(function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function h(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,h)}a((n=n.apply(t,e||[])).next())})}function n(t,e){var i,n,s,o,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function h(o){return function(h){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,n=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(s=(s=r.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){r=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){r.label=o[1];break}if(6===o[0]&&r.label<s[1]){r.label=s[1],s=o;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(o);break}s[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,h])}}}function s(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,s,o=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)r.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(s)throw s.error}}return r}function o(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}var r=function(){function t(t){this.list=[],this.id=t||String(Date.now())}return t.prototype.on=function(t,e,i){return void 0===i&&(i=!1),this.list[t]||(this.list[t]=[]),this.list[t].push({fn:e,onlyOnce:i}),this},t.prototype.one=function(t,e){return this.on(t,e,!0),this},t.prototype.off=function(t){for(var e in this.list)if(this.list.hasOwnProperty(e)&&t===e){this.list[t].length=0;break}return this},t.prototype.emit=function(t,e){var i=this.list[t];if(!i||!i.length)return this;for(var n=0;n<i.length;n++){var s=i[n],o=s.fn,r=s.onlyOnce;o.call(this,e),r&&i.splice(n--,1)}return this},t}(),h={stage:{mouseEnter:"stage.mouseEnter",mouseMove:"stage.mouseMove",mouseLeave:"stage.mouseLeave",mouseDown:"stage.mouseDown",click:"stage.click",mouseUp:"stage.mouseUp",contextMenu:"stage.contextMenu"},object:{mouseEnter:"object.mouseEnter",mouseMove:"object.mouseMove",mouseLeave:"object.mouseLeave",mouseDown:"object.mouseDown",click:"object.click",mouseUp:"object.mouseUp",contextMenu:"object.contextMenu"}},a="__H_DEVTOOLS_HOOK__",u=new r,c={UPDATE_STAGE:"UPDATE_STAGE",UPDATE_OBJECT:"UPDATE_OBJECT"};function l(t,e){window.postMessage({name:"h",type:t,data:e},"*")}u.on(c.UPDATE_STAGE,function(t){window[a]&&l(c.UPDATE_STAGE,t)}),u.on(c.UPDATE_OBJECT,function(t){window[a]&&l(c.UPDATE_OBJECT,t)});var p={bus:u,EVENT_TP:c,isEnable:function(){return!!window[a]},setStage:function(t){this.isEnable()&&(window[a].stage=t)},getSelectedObjectId:function(){return this.isEnable()?window[a].selectedObjectId:null}};function f(t,e,i){void 0===t&&(t=300),void 0===e&&(e=150),void 0===i&&(i=0);var n=document.createElement("canvas");return n.setAttribute("width",String(t)),n.setAttribute("height",String(e)),n.style.cssText="position: absolute; z-index: "+i+"; top: 0; left: 0;",n}var d,g=function(){function t(t){this.lastMouseEnterObjectId=null,this.objects=[],this.forceRender=!1,this.container=t.container,this.width=t.width,this.height=t.height,this.layerIndex=t.layerIndex,this.bus=new r;var e=f(this.width,this.height,this.layerIndex);this.canvas=e,this.ctx=e.getContext("2d"),this.container.appendChild(e);var i=f(this.width,this.height);this.cacheCanvas=i,this.cacheCtx=i.getContext("2d")}return t.prototype.resize=function(t,e){return this.canvas.width=t,this.canvas.height=e,this.cacheCanvas.width=t,this.cacheCanvas.height=e,this.width=t,this.height=e,this},t.prototype.add=function(){for(var t,e=this,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];return i.forEach(function(t){return t.layerIndex=e.layerIndex}),(t=this.objects).push.apply(t,o(i)),p.bus.emit("update.stage",null),this},t.prototype.insert=function(t){for(var e,i=this,n=[],s=1;s<arguments.length;s++)n[s-1]=arguments[s];return n.forEach(function(t){return t.layerIndex=i.layerIndex}),(e=this.objects).splice.apply(e,o([t,0],n)),p.bus.emit("update.stage",null),this},t.prototype.removeById=function(t){for(var e=!1,i=0;i<this.objects.length;i++)if(this.objects[i].id===t){this.objects.splice(i,1),e=!0;break}return this.forceRender=!0,p.bus.emit("update.stage",null),e},t.prototype.clear=function(){this.objects=[],this.forceRender=!0,p.bus.emit("update.stage",null)},t.prototype.shouldRender=function(){return this.objects.some(function(t){return t.needUpdate()})},t.prototype.renderObjects=function(t){var e=this;(t||this.shouldRender())&&(this.cacheCtx.clearRect(0,0,this.width,this.height),this.objects.forEach(function(t){return t.render(e.cacheCtx)}),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.cacheCanvas,0,0))},t.prototype.on=function(t,e,i){return void 0===i&&(i=!1),this.bus.on(t,e,i),this},t.prototype.onMouseEnter=function(t){this.bus.emit(h.stage.mouseEnter,{e:t})},t.prototype.onMouseMove=function(t){this.bus.emit(h.stage.mouseMove,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});if(e){if(this.lastMouseEnterObjectId)if(this.lastMouseEnterObjectId!==e.id){var i=this.getObjectById(this.lastMouseEnterObjectId);this.bus.emit(h.object.mouseLeave,{e:t,object:i}),this.bus.emit(h.object.mouseEnter,{e:t,object:e})}else this.bus.emit(h.object.mouseMove,{e:t,object:e});else this.bus.emit(h.object.mouseEnter,{e:t,object:e});this.lastMouseEnterObjectId=e.id}else{if(this.lastMouseEnterObjectId){i=this.getObjectById(this.lastMouseEnterObjectId);this.bus.emit(h.object.mouseLeave,{e:t,object:i})}this.lastMouseEnterObjectId=null}},t.prototype.onMouseDown=function(t){this.bus.emit(h.stage.mouseDown,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});e&&this.bus.emit(h.object.mouseDown,{e:t,object:e})},t.prototype.onClick=function(t){this.bus.emit(h.stage.click,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});e&&this.bus.emit(h.object.click,{e:t,object:e})},t.prototype.onMouseUp=function(t){this.bus.emit(h.stage.mouseUp,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});e&&this.bus.emit(h.object.mouseUp,{e:t,object:e})},t.prototype.onMouseLeave=function(t){this.bus.emit(h.stage.mouseLeave,{e:t})},t.prototype.onContextMenu=function(t){this.bus.emit(h.stage.contextMenu,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});e&&this.bus.emit(h.object.contextMenu,{e:t,object:e})},t.prototype.getObjectById=function(t){return this.objects.find(function(e){return e.id===t})},t.prototype.getObjectByPoint=function(t){for(var e=null,i=this.objects.length-1;i>=0;i--)if(this.objects[i].isPointOnObject(t)){e=this.objects[i];break}return e},t}(),y={devtools:{enable:!1,highlightColor:"rgba(33, 150, 243, .5)"}},m=1;!function(t){t[t.Free=0]="Free",t[t.Busy=1]="Busy"}(d||(d={}));var b,v=function(){function t(){this.id=1,this.width=1,this.height=1,this.status=d.Free,this.id=m++,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return t.prototype.isFree=function(){return this.status===d.Free},t.prototype.setWidth=function(t){this.canvas.width=t},t.prototype.setHeight=function(t){this.canvas.height=t},t.prototype.setFree=function(){this.status=d.Free},t.prototype.setBusy=function(){this.status=d.Busy},t}(),w=(b=[],{get:function(t,e,i){var n=b.find(function(t){return t.isFree()});n||(n=new v,b.push(n)),n.setBusy(),n.setWidth(e||1),n.setHeight(i||1),n.ctx.save(),t(n),n.ctx.restore(),n.setFree()}}),O=Math.PI;function x(t){return new Promise(function(e,i){var n=new Image;n.onload=e.bind(null,n),n.onerror=i.bind(null),n.src=t})}function E(t){return t*O/180}function j(t,e,i){var n=t.x,s=t.y,o=!1;return w.get(function(t){var r=t.ctx;e?e(r):(i||[]).forEach(function(t,e){return r[e?"lineTo":"moveTo"](t.x,t.y)}),o=r.isPointInPath(n,s)}),o}function T(t,e){var i=e.x,n=e.y;if(t.angle){return j({x:i,y:n},function(e){e.translate(t.rotateOriginLeft,t.rotateOriginTop),e.rotate(E(t.angle)),e.translate(t.left-t.rotateOriginLeft,t.top-t.rotateOriginTop),e.rect(0,0,t.width,t.height),e.stroke()})}var s=t.left,o=t.left+t.width,r=t.top,h=t.top+t.height;return i>=s&&i<=o&&n>=r&&n<=h}var F=function(){function t(t){this.forceRender=!1,this.hookInit=!1,this.animationFrameId=null,this.eventHandlers={},this.layers=[];var e=t.el,i=+t.width||300,n=+t.height||150;this.container="string"==typeof e?document.querySelector(e):e,this.container.style.width=i+"px",this.container.style.height=n+"px",this.container.style.position="relative",this.width=i,this.height=n,this.throttleDelay=t.throttleDelay||0;for(var s=0;s<(t.layerNumber||1);s++){var o=new g({container:this.container,width:this.width,height:this.height,layerIndex:s});this.layers.push(o)}this.initEvents(),this.initDevtoolsBus(),this.animationFrameId=requestAnimationFrame(this.loopAnim.bind(this))}return t.prototype.resize=function(t,e){this.container.style.width=t+"px",this.container.style.height=e+"px",this.width=t,this.height=e,this.layers.forEach(function(i){return i.resize(t,e)}),this.forceRender=!0},t.prototype.initDevtoolsBus=function(){var t=this;p.bus.on("update.stage",function(){p.isEnable()&&p.bus.emit(p.EVENT_TP.UPDATE_STAGE,JSON.stringify(t))})},t.prototype.loopAnim=function(){this.renderObjects(),this.initHook(),this.animationFrameId=requestAnimationFrame(this.loopAnim.bind(this))},t.prototype.initHook=function(){y.devtools.enable&&(this.hookInit||p.isEnable()&&(p.setStage(this),p.bus.emit(p.EVENT_TP.UPDATE_STAGE,JSON.stringify(this)),this.hookInit=!0))},t.prototype.renderObjects=function(){var t=this;this.layers.forEach(function(e){e.renderObjects(t.forceRender||e.forceRender),e.forceRender=!1}),this.forceRender=!1},t.prototype.initEvents=function(){var t=this;[{name:"mouseenter",layerFuncName:"onMouseEnter"},{name:"mousemove",layerFuncName:"onMouseMove",throttle:!0},{name:"mousedown",layerFuncName:"onMouseDown"},{name:"click",layerFuncName:"onClick"},{name:"mouseup",layerFuncName:"onMouseUp"},{name:"mouseleave",layerFuncName:"onMouseLeave"},{name:"contextmenu",layerFuncName:"onContextMenu"}].forEach(function(e){var i=e.name,n=e.layerFuncName,s=function(e){for(var i=t.layers.length-1;i>=0;i--){var s=t.layers[i];s[n].call(s,e)}},r=e.throttle&&t.throttleDelay?function(t,e,i){var n=0,s=null;return function(){s&&clearTimeout(s);var r=this,h=arguments,a=Date.now();a-n>t?(e.call.apply(e,o([r],h)),n=a):i&&(s=setTimeout(function(){e.call.apply(e,o([r],h)),n=Date.now()},t-(a-n)))}}(t.throttleDelay,s,!1):s;t.eventHandlers[i]=r,t.container.addEventListener(i,r)})},t.prototype.removeEvents=function(){for(var t in this.eventHandlers)this.eventHandlers.hasOwnProperty(t)&&this.container.removeEventListener(t,this.eventHandlers[t])},t.prototype.stopAnim=function(){cancelAnimationFrame(this.animationFrameId)},t.prototype.destroy=function(){this.stopAnim(),this.removeEvents()},t}(),S=1,D={gen:function(){return S++}},I=Math.abs,_=function(){function t(t){var e=this;return this.type="displayObject",this.updateFlag=!1,this.layerIndex=0,this.visible=!0,this.left=0,this.top=0,this.width=0,this.height=0,this.originX="left",this.originY="top",this.scaleX=1,this.scaleY=1,this.angle=0,this.debug=!1,this.id=D.gen(),this.proxy=new Proxy(this,{get:function(t,e,i){return"toJSON"===e?function(){return Object.assign({},t,{proxy:void 0})}:Reflect.get(t,e,i)},set:function(t,i,n,s){return t[i]!==n&&(Reflect.set(t,i,n,s),-1!==s.constructor.updateList.indexOf(i)&&e.update(i)),"updateFlag"!==i&&p.isEnable()&&p.bus.emit(p.EVENT_TP.UPDATE_OBJECT,{layerIndex:e.layerIndex,object:JSON.stringify(e)}),!0}}),this.set(t),this.proxy}return t.prototype.update=function(t){this.updateFlag=!0},t.prototype.set=function(t){if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},t.prototype.needUpdate=function(){return this.updateFlag},t.prototype.render=function(t){this.visible&&this._render(t)},t.prototype.isPointOnObject=function(t){return!!this.visible&&this._isPointOnObject(t)},t.prototype.renderDebug=function(t,e,i,n,s){this.debug&&(t.lineWidth=1,t.strokeStyle="black",t.strokeRect(e,i,n,s))},t.prototype.renderDevtoolsDebug=function(t,e,i,n,s){p.isEnable()&&this.id===p.getSelectedObjectId()&&(t.fillStyle=y.devtools.highlightColor,t.fillRect(e,i,n,s))},t.prototype.getOriginLeft=function(){return"center"===this.originX?this.left-this.getWidth()/2:"right"===this.originX?this.left-this.getWidth():this.left},t.prototype.getOriginTop=function(){return"center"===this.originY?this.top-this.getHeight()/2:"bottom"===this.originY?this.top-this.getHeight():this.top},t.prototype.getWidth=function(){return I(this.width*this.scaleX)},t.prototype.getHeight=function(){return I(this.height*this.scaleY)},t.updateList=["visible","left","top","originX","originY","scaleX","scaleY","angle","debug"],t}(),C=function(t){function s(e){var i=t.call(this,null)||this;return i.type="bitmap",i.set(e),i}return e(s,t),s.prototype.update=function(t){return i(this,void 0,void 0,function(){var e,i;return n(this,function(n){switch(n.label){case 0:if("src"!==t)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),e=this,[4,x(this.src)];case 2:return e.bitmapSource=n.sent(),this.width=this.bitmapSource.width,this.height=this.bitmapSource.height,this.updateFlag=!0,[3,4];case 3:return i=n.sent(),console.error(i),[3,4];case 4:return[2];case 5:return this.updateFlag=!0,[2]}})})},s.prototype._render=function(t){if(this.bitmapSource){var e=this.scaleX<0?-this.width:0,i=this.scaleY<0?-this.height:0;t.save(),this.angle?(t.translate(this.left,this.top),t.rotate(E(this.angle)),t.translate(this.getOriginLeft()-this.left,this.getOriginTop()-this.top)):t.translate(this.getOriginLeft(),this.getOriginTop()),t.scale(this.scaleX,this.scaleY),t.drawImage(this.bitmapSource,e,i),this.renderDebug(t,e,i,this.width,this.height),this.renderDevtoolsDebug(t,e,i,this.width,this.height),t.restore(),this.updateFlag=!1}else this.updateFlag=!1},s.prototype._isPointOnObject=function(t){return!!this.bitmapSource&&T({rotateOriginLeft:this.left,rotateOriginTop:this.top,left:this.getOriginLeft(),top:this.getOriginTop(),width:this.getWidth(),height:this.getHeight(),angle:this.angle},t)},s.updateList=o(_.updateList,["src"]),s}(_),P=function(){var t,e;return{measureText:function(i,n){return t||(t=document.createElement("div"),e=document.createElement("span"),t.style.cssText="position: absolute; left: -9999px; top: -9999px;",t.appendChild(e),document.body.appendChild(t)),e.innerText=i,e.style.cssText=n,{width:e.offsetWidth,height:e.offsetHeight}}}}(),M='"PingFang SC", Verdana, "Helvetica Neue", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans-serif',k=function(t){function i(e){var i=t.call(this,null)||this;return i.type="text",i.fontSize=14,i.fontWeight="normal",i.fontFamily=M,i.color="#000000",i.set(e),i}return e(i,t),i.prototype.update=function(t){-1!==["text","fontSize","fontWeight","fontFamily"].indexOf(t)&&this.calcDimensions(),this.updateFlag=!0},i.prototype.calcDimensions=function(){if(this.text&&this.fontSize){var t="\n      font-family: "+this.fontFamily+";\n      font-size: "+this.fontSize+"px;\n      font-weight: "+this.fontWeight+";\n    ",e=P.measureText(this.text,t);this.width=e.width,this.height=e.height}else this.width=this.height=0},i.prototype._render=function(t){var e=this.scaleX<0?-this.width:0,i=this.scaleY<0?-this.height:0;t.save(),this.angle?(t.translate(this.left,this.top),t.rotate(E(this.angle)),t.translate(this.getOriginLeft()-this.left,this.getOriginTop()-this.top)):t.translate(this.getOriginLeft(),this.getOriginTop()),t.scale(this.scaleX,this.scaleY),t.textAlign="left",t.textBaseline="top",t.fillStyle=this.color,t.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,t.fillText(this.text,e,i),this.renderDebug(t,e,i,this.width,this.height),this.renderDevtoolsDebug(t,e,i,this.width,this.height),t.restore(),this.updateFlag=!1},i.prototype._isPointOnObject=function(t){return T({rotateOriginLeft:this.left,rotateOriginTop:this.top,left:this.getOriginLeft(),top:this.getOriginTop(),width:this.getWidth(),height:this.getHeight(),angle:this.angle},t)},i.updateList=o(_.updateList,["text","fontSize","fontWeight","fontFamily","color"]),i}(_),L=Math.min,A=Math.max,B=function(t){function i(e){var i=t.call(this,null)||this;return i.type="polygon",i.points=[],i.lineWidth=1,i.strokeColor="#000000",i.fillColor="transparent",i.set(e),i}return e(i,t),i.prototype.update=function(t){"points"===t&&this.calcDimensions(),this.updateFlag=!0},i.prototype.calcDimensions=function(){if(this.points&&!(this.points.length<3)){var t=L.apply(void 0,o(this.points.map(function(t){return t.x}))),e=A.apply(void 0,o(this.points.map(function(t){return t.x}))),i=L.apply(void 0,o(this.points.map(function(t){return t.y}))),n=A.apply(void 0,o(this.points.map(function(t){return t.y})));this.width=e-t,this.height=n-i}},i.prototype._render=function(t){!this.points||this.points.length<3?this.updateFlag=!1:(t.save(),this.__render(t,!0,!0),t.restore(),this.updateFlag=!1)},i.prototype.__render=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var n=this.scaleX<0?-this.width:0,s=this.scaleY<0?-this.height:0;this.angle?(t.translate(this.left,this.top),t.rotate(E(this.angle)),t.translate(this.getOriginLeft()-this.left,this.getOriginTop()-this.top)):t.translate(this.getOriginLeft(),this.getOriginTop()),t.scale(this.scaleX,this.scaleY),t.lineWidth=this.lineWidth,t.fillStyle=this.fillColor,t.strokeStyle=this.strokeColor,t.beginPath(),this.points.forEach(function(e,i){t[i?"lineTo":"moveTo"](e.x+n,e.y+s)}),t.closePath(),t.stroke(),t.fill(),e&&this.renderDebug(t,n,s,this.width,this.height),i&&this.renderDevtoolsDebug(t,n,s,this.width,this.height)},i.prototype._isPointOnObject=function(t){return j(t,this.__render.bind(this))},i.updateList=o(_.updateList,["points","lineWidth","strokeColor","fillColor"]),i}(_),H=function(t){function s(e){var i=t.call(this,null)||this;return i.type="sprite",i.paused=!1,i.lastFrameTime=0,i.frameIndex=0,i.iteratedCount=0,i.statusEndCallbacks={},i.playbackRate=1,i.set(e),i}return e(s,t),s.prototype.update=function(t){return i(this,void 0,void 0,function(){var e,i,s;return n(this,function(n){switch(n.label){case 0:if("src"!==t)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),e=this,[4,x(this.src)];case 2:return e.bitmapSource=n.sent(),s=this.frames[this.status],this.width=s.frameWidth,this.height=s.frameHeight,this.reset(),this.updateFlag=!0,[3,4];case 3:return i=n.sent(),console.error(i),[3,4];case 4:return[2];case 5:return"status"===t&&((s=this.frames[this.status]).src&&s.src!==this.src?this.src=s.src:(this.width=s.frameWidth,this.height=s.frameHeight,this.reset())),this.updateFlag=!0,[2]}})})},s.prototype.setStatus=function(t,e,i){return void 0===i&&(i=!0),e&&this.addStatusEndCallback(t,e,i),this.status=t,this},s.prototype.addStatusEndCallback=function(t,e,i){this.statusEndCallbacks[t]||(this.statusEndCallbacks[t]=[]),this.statusEndCallbacks[t].push({fn:e,onlyOnce:i})},s.prototype.onStatusEnd=function(t){var e=this.statusEndCallbacks[t];if(e&&e.length)for(var i=0;i<e.length;i++){var n=e[i],s=n.fn;n.onlyOnce&&e.splice(i--,1),s&&s()}},s.prototype.reset=function(){this.lastFrameTime=0,this.frameIndex=0,this.iteratedCount=0,this.paused=!1},s.prototype.isAnimationEnd=function(){var t=this.frames[this.status];return this.paused||t.iterationCount&&this.iteratedCount>=t.iterationCount},s.prototype._render=function(t){if(this.bitmapSource){var e=Date.now(),i=this.frames[this.status];this.isAnimationEnd()&&(this.frameIndex=i.length-1);var n=i[this.frameIndex],s=this.scaleX<0?-this.width:0,o=this.scaleY<0?-this.height:0;t.save(),this.angle?(t.translate(this.left,this.top),t.rotate(E(this.angle)),t.translate(this.getOriginLeft()-this.left,this.getOriginTop()-this.top)):t.translate(this.getOriginLeft(),this.getOriginTop()),t.scale(this.scaleX,this.scaleY),t.drawImage(this.bitmapSource,n.x,n.y,this.width,this.height,s,o,this.width,this.height),this.renderDebug(t,s,o,this.width,this.height),this.renderDevtoolsDebug(t,s,o,this.width,this.height),t.restore(),this.lastFrameTime?e-this.lastFrameTime>=i.frameDuration/this.playbackRate&&(this.lastFrameTime=e,this.frameIndex++):(this.lastFrameTime=e,this.frameIndex++),this.frameIndex>=i.length&&(this.frameIndex=0,this.iteratedCount++),this.updateFlag=!this.isAnimationEnd(),this.updateFlag||this.onStatusEnd(this.status)}else this.updateFlag=!1},s.prototype.pause=function(){this.paused=!0},s.prototype.resume=function(){this.paused=!1,this.updateFlag=!0},s.prototype.replay=function(){this.reset(),this.updateFlag=!0},s.prototype._isPointOnObject=function(t){return T({rotateOriginLeft:this.left,rotateOriginTop:this.top,left:this.getOriginLeft(),top:this.getOriginTop(),width:this.getWidth(),height:this.getHeight(),angle:this.angle},t)},s.updateList=o(_.updateList,["src","frames","status"]),s}(_);return{Stage:F,DisplayObject:_,Bitmap:C,Text:k,Polygon:B,Sprite:H,EventTypes:h,config:y}});
//# sourceMappingURL=H.min.js.map

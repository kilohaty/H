!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.H=e()}(this,function(){"use strict";var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};function e(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}function i(t,e,i,s){return new(i||(i=Promise))(function(n,o){function r(t){try{a(s.next(t))}catch(t){o(t)}}function h(t){try{a(s.throw(t))}catch(t){o(t)}}function a(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(r,h)}a((s=s.apply(t,e||[])).next())})}function s(t,e){var i,s,n,o,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function h(o){return function(h){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=2&o[0]?s.return:o[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,o[1])).done)return n;switch(s=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,s=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(n=(n=r.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){r=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){r.label=o[1];break}if(6===o[0]&&r.label<n[1]){r.label=n[1],n=o;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(o);break}n[2]&&r.ops.pop(),r.trys.pop();continue}o=e.call(t,r)}catch(t){o=[6,t],s=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,h])}}}function n(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,n,o=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(s=o.next()).done;)r.push(s.value)}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return r}function o(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(n(arguments[e]));return t}var r=function(){function t(t){this.list=[],this.id=t||String(Date.now())}return t.prototype.on=function(t,e,i){return void 0===i&&(i=!1),this.list[t]||(this.list[t]=[]),this.list[t].push({fn:e,onlyOnce:i}),this},t.prototype.one=function(t,e){return this.on(t,e,!0),this},t.prototype.off=function(t){for(var e in this.list)if(this.list.hasOwnProperty(e)&&t===e){this.list[t].length=0;break}return this},t.prototype.emit=function(t,e){var i=this.list[t];if(!i||!i.length)return this;for(var s=0;s<i.length;s++){var n=i[s],o=n.fn,r=n.onlyOnce;o.apply(this,e),r&&i.splice(s,1)}return this},t}(),h={stage:{mouseEnter:"stage.mouseEnter",mouseMove:"stage.mouseMove",mouseLeave:"stage.mouseLeave",mouseDown:"stage.mouseDown",click:"stage.click",mouseUp:"stage.mouseUp",contextMenu:"stage.contextMenu"},object:{mouseEnter:"object.mouseEnter",mouseMove:"object.mouseMove",mouseLeave:"object.mouseLeave",mouseDown:"object.mouseDown",click:"object.click",mouseUp:"object.mouseUp",contextMenu:"object.contextMenu"}};function a(t,e){void 0===t&&(t=300),void 0===e&&(e=150);var i=document.createElement("canvas");return i.setAttribute("width",String(t)),i.setAttribute("height",String(e)),i.style.cssText="position: absolute; top: 0; left: 0;",i}var u,c=function(){function t(t){this.lastMouseEnterObjectId=null,this.forceRender=!1,this.objects=[];var e=t.el,i=+t.width||300,s=+t.height||150;this.container="string"==typeof e?document.querySelector(e):e,this.container.style.width=i+"px",this.container.style.height=s+"px",this.container.style.position="relative",this.width=i,this.height=s;var n=a(i,s);this.canvas=n,this.ctx=n.getContext("2d"),this.container.appendChild(n);var o=a(i,s);this.cacheCanvas=o,this.cacheCtx=o.getContext("2d"),requestAnimationFrame(this.loopAnim.bind(this)),this.initBus()}return t.prototype.loopAnim=function(){this.renderObjects(),requestAnimationFrame(this.loopAnim.bind(this))},t.prototype.renderObjects=function(){var t=this;!this.forceRender&&this.objects.every(function(t){return!t.visible||!t.needUpdate()})||(this.cacheCtx.clearRect(0,0,this.width,this.height),this.objects.forEach(function(e){return e.render(t.cacheCtx)}),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.cacheCanvas,0,0),this.forceRender=!1)},t.prototype.add=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(t=this.objects).push.apply(t,o(e)),this},t.prototype.remove=function(t){for(var e=0;e<this.objects.length;e++)if(this.objects[e].id===t){this.objects.splice(e,1),this.forceRender=!0;break}return this},t.prototype.initBus=function(){this.bus=new r,this.container.addEventListener("mouseenter",this.onMouseEnter.bind(this)),this.container.addEventListener("mousemove",this.onMouseMove.bind(this)),this.container.addEventListener("mousedown",this.onMouseDown.bind(this)),this.container.addEventListener("click",this.onClick.bind(this)),this.container.addEventListener("mouseup",this.onMouseUp.bind(this)),this.container.addEventListener("mouseleave",this.onMouseLeave.bind(this)),this.container.addEventListener("contextmenu",this.onContextMenu.bind(this))},t.prototype.onMouseEnter=function(t){this.bus.emit(h.stage.mouseEnter,{e:t})},t.prototype.onMouseMove=function(t){this.bus.emit(h.stage.mouseMove,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});if(e){if(this.lastMouseEnterObjectId)if(this.lastMouseEnterObjectId!==e.id){var i=this.getObjectById(this.lastMouseEnterObjectId);this.bus.emit(h.object.mouseLeave,{e:t,object:i}),this.bus.emit(h.object.mouseEnter,{e:t,object:e})}else this.bus.emit(h.object.mouseMove,{e:t,object:e});else this.bus.emit(h.object.mouseEnter,{e:t,object:e});this.lastMouseEnterObjectId=e.id}else{if(this.lastMouseEnterObjectId){i=this.getObjectById(this.lastMouseEnterObjectId);this.bus.emit(h.object.mouseLeave,{e:t,object:i})}this.lastMouseEnterObjectId=null}},t.prototype.onMouseDown=function(t){if(2!==t.button){this.bus.emit(h.stage.mouseDown,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});e&&this.bus.emit(h.object.mouseDown,{e:t,object:e})}},t.prototype.onClick=function(t){if(2!==t.button){this.bus.emit(h.stage.click,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});e&&this.bus.emit(h.object.click,{e:t,object:e})}},t.prototype.onMouseUp=function(t){if(2!==t.button){this.bus.emit(h.stage.mouseUp,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});e&&this.bus.emit(h.object.mouseUp,{e:t,object:e})}},t.prototype.onMouseLeave=function(t){this.bus.emit(h.stage.mouseLeave,{e:t})},t.prototype.onContextMenu=function(t){this.bus.emit(h.stage.contextMenu,{e:t});var e=this.getObjectByPoint({x:t.offsetX,y:t.offsetY});e&&this.bus.emit(h.object.contextMenu,{e:t,object:e})},t.prototype.getObjectById=function(t){return this.objects.find(function(e){return e.id===t})},t.prototype.getObjectByPoint=function(t){for(var e=null,i=this.objects.length-1;i>=0;i--)if(this.objects[i].isPointOnObject(t)){e=this.objects[i];break}return e},t}(),l=1,p={gen:function(){return l++}},f=Math.abs,d=function(){function t(t){var e=this;return this.type="displayObject",this.updateFlag=!1,this.visible=!0,this.left=0,this.top=0,this.width=0,this.height=0,this.originX="left",this.originY="top",this.scaleX=1,this.scaleY=1,this.id=p.gen(),this.proxy=new Proxy(this,{get:function(t,e,i){return Reflect.get(t,e,i)},set:function(t,i,s,n){return t[i]!==s&&(Reflect.set(t,i,s,n),-1!==n.constructor.updateList.indexOf(i)&&e.update(i)),!0}}),this.set(t),this.proxy}return t.prototype.update=function(t){this.updateFlag=!0},t.prototype.set=function(t){if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},t.prototype.needUpdate=function(){return this.updateFlag},t.prototype.render=function(t){this.visible&&this._render(t)},t.prototype.isPointOnObject=function(t){return!!this.visible&&this._isPointOnObject(t)},t.prototype.getLeft=function(){return"center"===this.originX?this.left-this.width/2:"right"===this.originX?this.left-this.width:this.left},t.prototype.getTop=function(){return"center"===this.originY?this.top-this.height/2:"bottom"===this.originY?this.top-this.height:this.top},t.prototype.getWidth=function(){return f(this.width*this.scaleX)},t.prototype.getHeight=function(){return f(this.height*this.scaleY)},t.prototype.getOriginPoint=function(){var t="center"===this.originX?this.width/2:"right"===this.originX?this.width:0,e="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0;return{x:t=f(t*this.scaleX),y:e=f(e*this.scaleY)}},t.updateList=["visible","left","top","originX","originY"],t}(),g=1;!function(t){t[t.Free=0]="Free",t[t.Busy=1]="Busy"}(u||(u={}));var y,m=function(){function t(){this.id=1,this.width=1,this.height=1,this.status=u.Free,this.id=g++,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return t.prototype.isFree=function(){return this.status===u.Free},t.prototype.setWidth=function(t){this.canvas.width=t},t.prototype.setHeight=function(t){this.canvas.height=t},t.prototype.setFree=function(){this.status=u.Free},t.prototype.setBusy=function(){this.status=u.Busy},t}(),b=(y=[],{get:function(t,e,i){var s=y.find(function(t){return t.isFree()});s||(s=new m,y.push(s)),s.setBusy(),s.setWidth(e||1),s.setHeight(i||1),s.ctx.save(),t(s,function(){s.ctx.restore(),s.setFree()})}});Math.PI;function v(t){return new Promise(function(e,i){var s=new Image;s.onload=e.bind(null,s),s.onerror=i.bind(null),s.src=t})}function x(t,e){var i=this,s=e.x,n=e.y,o=t.left,r=t.left+t.width,h=t.top,a=t.top+t.height;if(t.angle){var u=[{x:o,y:h},{x:r,y:h},{x:r,y:a},{x:o,y:a}].map(function(e){return i.rotatePoint({x:o,y:h},t.angle,e)});return this.isPointInPath(u,{x:s,y:n})}return s>=o&&s<=r&&n>=h&&n<=a}var w=function(t){function n(e){var i=t.call(this,null)||this;return i.type="bitmap",i.set(e),i}return e(n,t),n.prototype.update=function(t){return i(this,void 0,void 0,function(){var e,i;return s(this,function(s){switch(s.label){case 0:if("src"!==t)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),e=this,[4,v(this.src)];case 2:return e.bitmapSource=s.sent(),this.width=this.bitmapSource.width,this.height=this.bitmapSource.height,this.updateFlag=!0,[3,4];case 3:return i=s.sent(),console.error(i),[3,4];case 4:return[2];case 5:return this.updateFlag=!0,[2]}})})},n.prototype._render=function(t){if(this.bitmapSource){var e=this.scaleX<0?-this.width:0,i=this.scaleY<0?-this.height:0;t.save(),t.translate(this.getLeft(),this.getTop()),t.scale(this.scaleX,this.scaleY),t.drawImage(this.bitmapSource,e,i),t.restore(),this.updateFlag=!1}else this.updateFlag=!1},n.prototype._isPointOnObject=function(t){return!!this.bitmapSource&&x({left:this.getLeft(),top:this.getTop(),width:this.getWidth(),height:this.getHeight(),angle:0},t)},n.updateList=o(d.updateList,["src"]),n}(d),j=function(){var t,e;return{measureText:function(i,s){return t||(t=document.createElement("div"),e=document.createElement("span"),t.style.cssText="position: absolute; left: -9999px; top: -9999px;",t.appendChild(e),document.body.appendChild(t)),e.innerText=i,e.style.cssText=s,{width:e.offsetWidth,height:e.offsetHeight}}}}(),O='"PingFang SC", Verdana, "Helvetica Neue", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans-serif',F=function(t){function i(e){var i=t.call(this,null)||this;return i.type="text",i.fontSize=14,i.fontWeight="normal",i.fontFamily=O,i.color="#000000",i.set(e),i}return e(i,t),i.prototype.update=function(t){-1!==["text","fontSize","fontWeight","fontFamily"].indexOf(t)&&this.calcDimensions(),this.updateFlag=!0},i.prototype.calcDimensions=function(){if(this.text&&this.fontSize){var t="\n      font-family: "+this.fontFamily+";\n      font-size: "+this.fontSize+"px;\n      font-weight: "+this.fontWeight+";\n    ",e=j.measureText(this.text,t);this.width=e.width,this.height=e.height}else this.width=this.height=0},i.prototype._render=function(t){var e=this.scaleX<0?-this.width:0,i=this.scaleY<0?-this.height:0;t.save(),t.translate(this.getLeft(),this.getTop()),t.scale(this.scaleX,this.scaleY),t.textAlign="left",t.textBaseline="top",t.fillStyle=this.color,t.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,t.fillText(this.text,e,i),t.strokeRect(e,i,this.width,this.height),t.restore(),this.updateFlag=!1},i.prototype._isPointOnObject=function(t){return x({left:this.getLeft(),top:this.getTop(),width:this.getWidth(),height:this.getHeight(),angle:0},t)},i.updateList=o(d.updateList,["text","fontSize","fontWeight","fontFamily","color"]),i}(d),M=Math.min,E=Math.max,L=function(t){function i(e){var i=t.call(this,null)||this;return i.type="polygon",i.points=[],i.lineWidth=1,i.strokeColor="#000000",i.fillColor="transparent",i.set(e),i}return e(i,t),i.prototype.update=function(t){"points"===t&&this.calcDimensions(),this.updateFlag=!0},i.prototype.calcDimensions=function(){if(this.points&&!(this.points.length<3)){var t=M.apply(void 0,o(this.points.map(function(t){return t.x}))),e=E.apply(void 0,o(this.points.map(function(t){return t.x}))),i=M.apply(void 0,o(this.points.map(function(t){return t.y}))),s=E.apply(void 0,o(this.points.map(function(t){return t.y})));this.width=e-t,this.height=s-i}},i.prototype._render=function(t){!this.points||this.points.length<3?this.updateFlag=!1:(this.__render(t),this.updateFlag=!1)},i.prototype.__render=function(t){var e=this.scaleX<0?-this.width:0,i=this.scaleY<0?-this.height:0;t.save(),t.translate(this.left,this.top),t.scale(this.scaleX,this.scaleY),t.lineWidth=this.lineWidth,t.fillStyle=this.fillColor,t.strokeStyle=this.strokeColor,t.beginPath(),this.points.forEach(function(s,n){t[n?"lineTo":"moveTo"](s.x+e,s.y+i)}),t.closePath(),t.stroke(),t.fill(),t.restore()},i.prototype._isPointOnObject=function(t){return e=null,i=t,s=this.__render.bind(this),n=i.x,o=i.y,r=!1,b.get(function(t){var i=t.ctx;s?s(i):e.forEach(function(t,e){return i[e?"lineTo":"moveTo"](t.x,t.y)}),r=i.isPointInPath(n,o)}),r;var e,i,s,n,o,r},i.updateList=o(d.updateList,["points","lineWidth","strokeColor","fillColor"]),i}(d),S=function(t){function n(e){var i=t.call(this,null)||this;return i.type="sprite",i.paused=!1,i.lastFrameTime=0,i.frameIndex=0,i.iteratedCount=0,i.set(e),i}return e(n,t),n.prototype.update=function(t){return i(this,void 0,void 0,function(){var e,i,n;return s(this,function(s){switch(s.label){case 0:if("src"!==t)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),e=this,[4,v(this.src)];case 2:return e.bitmapSource=s.sent(),n=this.frames[this.status],this.width=n.frameWidth,this.height=n.frameHeight,this.reset(),this.updateFlag=!0,[3,4];case 3:return i=s.sent(),console.error(i),[3,4];case 4:return[2];case 5:return"status"===t&&((n=this.frames[this.status]).src&&n.src!==this.src?this.src=n.src:(this.width=n.frameWidth,this.height=n.frameHeight,this.reset())),this.updateFlag=!0,[2]}})})},n.prototype.reset=function(){this.lastFrameTime=0,this.frameIndex=0,this.iteratedCount=0,this.paused=!1},n.prototype.isAnimationEnd=function(){var t=this.frames[this.status];return this.paused||t.iterationCount&&this.iteratedCount>t.iterationCount},n.prototype._render=function(t){if(this.bitmapSource){var e=Date.now(),i=this.frames[this.status],s=i[this.frameIndex],n=this.scaleX<0?-this.width:0,o=this.scaleY<0?-this.height:0;t.save(),t.translate(this.getLeft(),this.getTop()),t.scale(this.scaleX,this.scaleY),t.drawImage(this.bitmapSource,s.x,s.y,this.width,this.height,n,o,this.width,this.height),t.restore(),this.lastFrameTime?e-this.lastFrameTime>=i.frameDuration&&(this.frameIndex++,this.lastFrameTime=e,this.frameIndex>=i.length&&(this.frameIndex=0,this.iteratedCount++)):this.lastFrameTime=e,this.updateFlag=!this.isAnimationEnd()}else this.updateFlag=!1},n.prototype.pause=function(){this.paused=!0},n.prototype.resume=function(){this.paused=!1,this.updateFlag=!0},n.prototype.replay=function(){this.reset(),this.updateFlag=!0},n.prototype._isPointOnObject=function(t){return x({left:this.getLeft(),top:this.getTop(),width:this.getWidth(),height:this.getHeight(),angle:0},t)},n.updateList=o(d.updateList,["src","frames","status"]),n}(d);return{Stage:c,DisplayObject:d,Bitmap:w,Text:F,Polygon:L,Sprite:S,EventTypes:h}});
//# sourceMappingURL=H.min.js.map

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.H=e()}(this,function(){"use strict";var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};function e(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}function i(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{a(n.next(t))}catch(t){o(t)}}function h(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,h)}a((n=n.apply(t,e||[])).next())})}function n(t,e){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function h(o){return function(h){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,h])}}}function r(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}function o(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t}function s(t,e){void 0===t&&(t=300),void 0===e&&(e=150);var i=document.createElement("canvas");return i.setAttribute("width",String(t)),i.setAttribute("height",String(e)),i.style.cssText="position: absolute; top: 0; left: 0;",i}var h=function(){function t(t){this.forceRender=!1,this.objects=[];var e=t.el,i=+t.width||300,n=+t.height||150;this.container="string"==typeof e?document.querySelector(e):e,this.container.style.width=i+"px",this.container.style.height=n+"px",this.container.style.position="relative",this.width=i,this.height=n;var r=s(i,n);this.canvas=r,this.ctx=r.getContext("2d"),this.container.appendChild(r);var o=s(i,n);this.cacheCanvas=o,this.cacheCtx=o.getContext("2d"),requestAnimationFrame(this.loopAnim.bind(this))}return t.prototype.loopAnim=function(){this.renderObjects(),requestAnimationFrame(this.loopAnim.bind(this))},t.prototype.renderObjects=function(){var t=this;!this.forceRender&&this.objects.every(function(t){return!t.visible||!t.needUpdate()})||(this.cacheCtx.clearRect(0,0,this.width,this.height),this.objects.forEach(function(e){e.visible&&e.render(t.cacheCtx)}),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.cacheCanvas,0,0),this.forceRender=!1)},t.prototype.add=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(t=this.objects).push.apply(t,o(e)),this},t.prototype.remove=function(t){for(var e=0;e<this.objects.length;e++)if(this.objects[e].id===t){this.objects.splice(e,1),this.forceRender=!0;break}return this},t}(),a=1,c={gen:function(){return a++}},u=Math.abs,l=function(){function t(t){var e=this;return this.type="displayObject",this.updateFlag=!1,this.visible=!0,this.left=0,this.top=0,this.width=0,this.height=0,this.originX="left",this.originY="top",this.scaleX=1,this.scaleY=1,this.id=c.gen(),this.proxy=new Proxy(this,{get:function(t,e,i){return Reflect.get(t,e,i)},set:function(t,i,n,r){return Reflect.set(t,i,n,r),-1!==r.constructor.updateList.indexOf(String(i))&&e.update(String(i)),!0}}),this.set(t),this.proxy}return t.prototype.update=function(t){this.updateFlag=!0},t.prototype.set=function(t){if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},t.prototype.needUpdate=function(){return this.updateFlag},t.prototype.getWidth=function(){return u(this.width*this.scaleX)},t.prototype.getHeight=function(){return u(this.height*this.scaleY)},t.prototype.getOriginPoint=function(){var t="center"===this.originX?this.width/2:"right"===this.originX?this.width:0,e="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0;return{x:t=u(t*this.scaleX),y:e=u(e*this.scaleY)}},t.updateList=["visible","left","top","originX","originY"],t}();var f=function(t){function r(e){var i=t.call(this,null)||this;return i.type="bitmap",i.set(e),i}return e(r,t),r.prototype.update=function(t){return i(this,void 0,void 0,function(){var e,i;return n(this,function(n){switch(n.label){case 0:if("src"!==t)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),e=this,[4,(r=this.src,new Promise(function(t,e){var i=new Image;i.onload=t.bind(null,i),i.onerror=e.bind(null),i.src=r}))];case 2:return e.bitmapSource=n.sent(),this.width=this.bitmapSource.width,this.height=this.bitmapSource.height,this.updateFlag=!0,[3,4];case 3:return i=n.sent(),console.error(i),[3,4];case 4:return[2];case 5:return this.updateFlag=!0,[2]}var r})})},r.prototype.render=function(t){if(this.bitmapSource){var e=this.getOriginPoint(),i=e.x,n=e.y,r=this.scaleX<0?-this.width:0,o=this.scaleY<0?-this.height:0;t.save(),t.translate(this.left-i,this.top-n),t.scale(this.scaleX,this.scaleY),t.drawImage(this.bitmapSource,r,o),t.restore(),this.updateFlag=!1}else this.updateFlag=!1},r.updateList=o(l.updateList,["src"]),r}(l),p=function(){var t,e;return{measureText:function(i,n){return t||(t=document.createElement("div"),e=document.createElement("span"),t.style.cssText="position: absolute; left: -9999px; top: -9999px;",t.appendChild(e),document.body.appendChild(t)),e.innerText=i,e.style.cssText=n,{width:e.offsetWidth,height:e.offsetHeight}}}}(),d='"PingFang SC", Verdana, "Helvetica Neue", "Microsoft Yahei", "Hiragino Sans GB", "Microsoft Sans Serif", "WenQuanYi Micro Hei", sans-serif',g=function(t){function r(e){var i=t.call(this,null)||this;return i.type="text",i.fontSize=14,i.fontWeight="normal",i.fontFamily=d,i.color="#000000",i.set(e),i}return e(r,t),r.prototype.update=function(t){return i(this,void 0,void 0,function(){return n(this,function(e){return-1!==["text","fontSize","fontWeight","fontFamily"].indexOf(t)&&this.calcDimensions(),this.updateFlag=!0,[2]})})},r.prototype.calcDimensions=function(){if(this.text&&this.fontSize){var t="\n      font-family: "+this.fontFamily+";\n      font-size: "+this.fontSize+"px;\n      font-weight: "+this.fontWeight+";\n    ",e=p.measureText(this.text,t);this.width=e.width,this.height=e.height}else this.width=this.height=0},r.prototype.render=function(t){var e=this.getOriginPoint(),i=e.x,n=e.y,r=this.scaleX<0?-this.width:0,o=this.scaleY<0?-this.height:0;t.save(),t.translate(this.left-i,this.top-n),t.scale(this.scaleX,this.scaleY),t.textAlign="left",t.textBaseline="top",t.fillStyle=this.color,t.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,t.fillText(this.text,r,o),t.restore(),this.updateFlag=!1},r.updateList=o(l.updateList,["text","fontSize","fontWeight","fontFamily","color"]),r}(l);return{Stage:h,DisplayObject:l,Bitmap:f,Text:g}});
//# sourceMappingURL=H.min.js.map
